<!--
 * @Author: zzzzztw
 * @Date: 2023-04-21 16:09:16
 * @LastEditors: Do not edit
 * @LastEditTime: 2023-04-21 16:48:52
 * @FilePath: /myLearning/Redislearn/14如何应对变慢的Redis.md
-->
# 如何应对Redis变慢

1. 确定是不是redis真的变慢了
   * 首先确定一个延迟基线，这个是系统在低压力，无干扰下的性能，这个性能有软硬件配置决定
   * 在服务端使用redis-cli命令``` ./redis-cli --intrinsic-latency 时间ms 来查看当前多少秒内的延迟
   * 基本上达到基线的2倍以上延迟就确定redis变慢了

2. 如何应对?
   * 首先生产中最大的可能是bigkey造成的同时过期或有热点数据等
   1. * 使用了慢查询命令：
        * 慢查询命令就是只运行速度很慢的命令，导致redis延迟增加，比如集合或排序等，一般在服务端这些操作会被禁止。 还有KEYS命令，返回所有和输入匹配的所有key，类似模糊查询，也是慢查询命令。
   2. * 过期key操作：过期 key 的自动删除机制。默认情况下，Redis 每 100 毫秒会删除一些过期 key，具体的算法如下：采样 ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP 个数的 key，并将其中过期的 key 全部删除；如果超过 25% 的 key 过期了，则重复删除的过程，直到过期 key 的比例降至 25% 以下。 2.同一时间大量缓存过期，超过了上述第二条阈值（缓存雪崩），会不断进行删除key + 操作系统整理内存。 3.删除操作是阻塞的（Redis 4.0后可以用异步线程减少阻塞影响）所以应该检察业务，尽量避免过期key都设置在同一个时间点上。
   3. AOF重写时，新数据写入的量比较大。
   4. 查看是否是计算机物理内存不足导致一直在swap：操作系统为了缓解内存不足对应用程序的影响，允许把一部分内存中的数据换到磁盘上，以达到应用程序对内存使用的缓冲，这些内存数据被换到磁盘上的区域，就是 Swap。 问题就在于，当内存中的数据被换到磁盘上后，Redis 再访问这些数据时，就需要从磁盘上读取，访问磁盘的速度要比访问内存慢几百倍