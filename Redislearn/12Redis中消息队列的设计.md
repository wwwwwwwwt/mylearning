<!--
 * @Author: zzzzztw
 * @Date: 2023-04-19 15:47:13
 * @LastEditors: Do not edit
 * @LastEditTime: 2023-04-19 15:50:14
 * @FilePath: /myLearning/Redislearn/12Redis中消息队列的设计.md
-->
# Redis用作分布式系统中消息队列的设计

1. 消息队列的三个需求: 1) 消息的有序性先来后到 2)消息的可重复幂等，多次发送同一条消息结果一样 3)消息可靠性，宕机了出现消息没处理完成，此时消息队列需要保证消息可靠性，即消费者重启后可以再次读取消息进行处理，不会出现漏消息。

2. Redis中的list 和 streams都支持上述三个需求。
3. list：1. 天然有序性 2. 需要自行提供全局id作为可重复幂等的判断依据，处理过这个id就不处理了 3. 可靠性由lish中的BRPOPLPUSH命令保证，会将消息放进一个备份list中，重启后根据全局id从备份list读取数据。
4. Streams：streams是redis 5.0以后为消息队列设计的数据结构，还可以满足多个消费者组成消费组一起进行消息队列消费的场景。

## redis作为消息队列的争议

1. redis非常轻量，如果消息通信量不大并且没有严格的可靠性要求（aof等有一秒延迟宕机可能会丢数据，开主从库写入量大时也会有主从延迟，此时进行主从切换，可能会丢数据。无法保证消息完整性可），可以用redis。
2. 更推荐kafka + zookeeper和rabbitmq当作重量级消息队列