<!--
 * @Author: zzzzztw
 * @Date: 2023-05-15 19:22:36
 * @LastEditors: Do not edit
 * @LastEditTime: 2023-05-20 16:38:53
 * @FilePath: /myLearning/linux网络编程/1TCPIP四层模型与osi七层模型.md
-->
# 1. TCP/IP四层模型和OSI七层模型

### OSI七层模型：

<center>

![](img/1.1.png)

</center>

- 应用层：与用户交互的接口层
- 表示层：用户信息和网络格式信息在这一层进行转换
- 会话层：建立和管理应用程序实现自动收发包的功能层
- 传输层：TCP/UDP协议层，监控数据传输服务的质量，保证报文的正确传输。
- 网络层：IP层，根据IP协议进行寻址，从而发送网络包
- 数据链路层：根据ARP协议获得mac头部加在Ip头部上，作用是在以太网之间（电脑上的以太网接口，wifi接口，交换机等）进行通讯，需要用到mac地址
- 物理层：光纤等硬件中的2进制信息，传输数据帧。
  
#### 其中OSI七层模型中的应用层，表示层，会话层对应着TCP/IP四层模型中的应用层，传输层和网络层对应传输层和网络层，数据链路层和物理层对应着网络接口层。


### TCP/IP四层模型：

* 应用层http/https， 传输层tcp（流量控制，超时重传，拥塞控制）/udp， 网络层ip， 网络接口层（由ip协议经过arp协议获取对方mac地址）

1. http层：
   1. 承载消息体消息内容
   2. 需要解析目标url，然后得到具体域名。拿到域名后先看浏览器缓存，再看操作系统缓存，再看host文件，都没有对应域名的IP地址的话，就从根服务器一直问到权威服务器从而得到对应域名的ip地址。
   3. 然后根据内核暴露出来的socket接口，向对应IP和端口发送消息报文，报文进入内核网络协议栈
2. tcp层：
   1. tcp协议：包括源端口号（为每个进程都随机一个端口），目标端口（自己输入的），序号（解决乱序的），状态位（表示建立连接时不同的状态），窗口大小（用于流量控制，通信双方声明一个缓存大小，表示自己能够处理数据的能力，别发的太快也别发的太慢），拥塞控制（感应网络的拥堵形况，控制自己的发送速度）。
   2. 建立连接时会采用三次握手，保证双方都有收发能力，防止历史异常中断的报文进入新的连接中。
   3. 客户端向服务端发起syn进行握手，此时客户端是syn_send状态，listen状态的服务端接收一个syn请求，返回应答ack并发送自己的syn，此时服务端进入syn_rcvd状态，客户端收到ack和syn后，再发送一个ack应答表示收到服务端发来的syn状态变为established，服务端收到ack后变为established。
   4. 经过三次握手建立连接后，tcp分割数据：如果http报文内容太长超过了MSS长度，会被tcp协议分割成多个网络包分批发送，MTU是IP协议中的最大网络数据包大小一般为1500字节，包括IP协议头和TCP协议头和真正的数据包内容，这个数据包内容的大小是MSS长度。数据包内容是http报文头和消息内容。
   5. 组装tcp报文，加上tcp协议头（第一步的那些，源端口号和目的端口号）发送给下一个协议栈IP层
3. ip层：
   1. tcp在执行连接，收发，断开等操作时，都需要ip协议将tcp的报文包装成网络包发送给通信对象
   2. ip包内有源地址ip和目标地址ip，协议号（tcp为06 十六进制），首部长度等参数
4. 生成ip报文后需要为ip报文加上mac头部，这个是以太网使用的头部，包括发送方的mac地址和接收方的mac地址
   1. 发送方的mac地址写在网卡中，直接读取
   2. 接收方的mac地址通过ARP协议向以太网中进行广播，向所有设备广播，回答后把结果放在缓存中。
   3. 在ip报文基础上加上mac头部，经过网卡（数字信息转换为电信号），交换机（），路由器发送给服务器（通过查表调到下一个路由器或设备）。
5. 服务器反方向层层拨开协议头，最终拿到数据。  