<!--
 * @Author: zzzzztw
 * @Date: 2023-03-29 14:48:18
 * @LastEditors: Do not edit
 * @LastEditTime: 2023-03-29 22:03:59
 * @FilePath: /cpptest/mysql45/04索引（上）.md
-->
# 索引
* 优点：提高查询效率，通过对索引排序降低成本
* 缺点：索引也要占空间名单insert，update，delete需要进行页分裂和页合并，效率降低。
## 常见的索引模型
1. 哈希表：以key-val存储，但大量数据容易出现哈希冲突，拉链法会退化成o(n),范围查询会全表扫描。
2. 有序数组:查询ologn复杂度，但插入记录就要挪动后面所有记录，成本很高，只适用于静态存储，如2020年的某个城市人口信息
3. 二叉查找树BST：解决排序问题，但无法保证平衡，可能退化成单链表
4. 二叉平衡树AVL：通过旋转解决了平衡问题，但旋转操作导致效率很低
5. 红黑树：引入红黑节点，解决了AVL旋转次数过多效率太低问题，但树高仍会过高，io次数太多
6. B树：通过将二叉树变为多路平衡查找树，解决树过高问题
7. B+树，在B树的基础上，将非叶节点改造为不存储数据的纯索引节点，进一步降低了树的高度；此外将叶节点使用指针连接成链表，范围查询更加高效。
   * B+树，采用n叉树，n取决于==== 页/（索引+指针）的大小，例如，一个页16k， 一个bigint索引8B，一个指针6B，n = 16*1024 / 8+6 约等于1170.
9. 问题：为什么innodb选择B+树而不选其他的
   * 答：
      * 数据一定时，其他树层级更高，效率慢。 
      * B+树非叶子节点不存放数据只存放key，一页中能存放更多的key，B树所有节点存放key-val，相同页大小，存放的指针更少，要保存更多的数据只能增加树的高度，导致性能降低
      * 哈希不支持范围查询。
## 索引分类
1. 主键索引：针对表中主键创建的索引，不创建的话默认会自动创建，只能存在一个，PRIMARY关键字指定
2. 唯一索引：避免同一个表中某列数据中的值重复，可以有多个，关键字UNIQUE
3. 常规索引：快速定位特定的数据，可以有多个
4. 全文索引：用于全文查找文本中的关键词，可以有多个 关键词FULLTEXT
5. 聚簇索引：将数据存储与索引放到了一块，索引结构的叶子节点保存对应的行数据， 必须有且只能有一个
6. 二级索引：索引的叶子节点关联的是对应的主键，可以存在多个
## 聚簇索引选取原则
1. 有主键选主键
2. 无主键选第一个UNIQUE键，唯一索引
3. 都没有，会自动生成一个rowid当隐藏的聚簇索引
## 二级索引回表查询流程
1. 现在二级索引中查到对应的主键，再拿着主键去聚簇索引中寻找对应的数据，如下图
<center>

![](img/04(1).jpg)

</center>

2. 思考题：  
   1. innodb主键索引的B+树有多高？
   * 答：
     * 首先先默认1170叉树， 一页16kb，一个指针6字节，一个bigint8字节 16 * 1024 /14约等于1170，说明一页能存1170个索引
     * 数据行：一页16k，假设一行数据1k，一页能存16行这个数据
     * 总共：高度为2，1170 * 16 约为 2w数据， 告诉为3 1170 * 1170 * 16 约为2000w条数据